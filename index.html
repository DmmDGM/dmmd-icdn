<!-- HTML -->
<!DOCTYPE html>
<html lang="en">
    <!-- Head -->
    <head>
        <!-- Meta -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <!-- Title -->
        <title>Gallery</title>

        <!-- Styles -->
        <link rel="stylesheet" href="./assets/fonts.css">
        <link rel="stylesheet" href="./assets/soda.css">
        <link rel="stylesheet" href="./assets/reset.css">
        <link rel="stylesheet" href="./assets/navigation.css">
        <link rel="stylesheet" href="./assets/gallery.css">
    </head>

    <!-- Body -->
    <body>
        <!-- Navigation -->
        <nav>
            <div id="home">
                <span>DmmD ICDN</span>
            </div>
            <div id="order">
                <button id="order-asc">Ascending</button>
                <button class="active" id="order-desc">Descending</button>
            </div>
            <div id="sort">
                <button id="sort-name">Name</button>
                <button class="active" id="sort-time">Time</button>
                <button id="sort-uuid">UUID</button>
            </div>
            <input id="search" placeholder="Search">
            <div id="controls">
                <button id="controls-upload">Upload</button>
                <button id="controls-refresh">Refresh</button>
                <button id="controls-details">Details</button>
            </div>
        </nav>

        <!-- Gallery -->
        <div id="gallery"></div>

        <!-- Scripts -->
        <script src="./assets/index.js" type="module"></script>
        <script>
            // Defines gallery
            const gallery = document.getElementById("gallery");

            // Defines order
            const order = {
                ascending: document.getElementById("order-asc"),
                descending: document.getElementById("order-desc"),
                value: () => {
                    return order.ascending.classList.contains("active") ? "asc" : "desc";
                },
            };
            order.ascending.addEventListener("click", async () => {
                // Updates order
                order.ascending.classList.add("active");
                order.descending.classList.remove("active");
                
                // Refreshes
                await refresh();
            });
            order.descending.addEventListener("click", async () => {
                // Updates order
                order.ascending.classList.remove("active");
                order.descending.classList.add("active");
                
                // Refreshes
                await refresh();
            });

            // Defines sort
            const sort = {
                name: document.getElementById("sort-name"),
                time: document.getElementById("sort-time"),
                uuid: document.getElementById("sort-uuid"),
                value: () => {
                    return sort.name.classList.contains("active") ? "name" :
                        sort.time.classList.contains("active") ? "time" : "uuid";
                }
            };
            sort.name.addEventListener("click", async () => {
                // Updates sort
                sort.name.classList.add("active");
                sort.time.classList.remove("active");
                sort.uuid.classList.remove("active");

                // Refreshes
                await refresh();
            });
            sort.time.addEventListener("click", async () => {
                // Updates sort
                sort.name.classList.remove("active");
                sort.time.classList.add("active");
                sort.uuid.classList.remove("active");

                // Refreshes
                await refresh();
            });
            sort.uuid.addEventListener("click", async () => {
                // Updates sort
                sort.name.classList.remove("active");
                sort.time.classList.remove("active");
                sort.uuid.classList.add("active");

                // Refreshes
                await refresh();
            });

            // Defines loaders
            async function create(uuid) {
                // Fetches mime
                const uri = `/preview/${uuid}`;
                // const mime = (await fetch(uri, { method: "HEAD" })).headers.get("Content-Type");
                // if(mime === null || mime === "text/plain") throw new Error("Invalid MIME");

                // Creates element
                const tag = "img";
                const item = document.createElement(tag);
                item.src = uri;
                item.classList.add("item");

                // Creates box
                const box = document.createElement("button");
                box.classList.add("box");
                box.appendChild(item);
                
                // Returns box
                return box;
            }

            async function refresh() {

            }

            async function loadAll() {
                const uuids = await (await fetch("/list?count=100")).json();
                const start = performance.now();
                await Promise.all(uuids.map(async (uuid) => {
                    gallery.appendChild(await create(uuid));
                }));
                const end = performance.now();
                console.log(end - start);
            }

            loadAll();
        </script>
    </body>
</html>
